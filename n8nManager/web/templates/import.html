{% extends "base.html" %}
{% block title %}Import - n8nManager{% endblock %}
{% block content %}
<div class="import-page">
    <h1>Workflow importieren</h1>
    <div class="import-dropzone" id="dropzone" ondragover="event.preventDefault()" ondrop="handleDrop(event)">
        <p>n8n JSON-Datei hier ablegen</p>
        <p>oder</p>
        <input type="file" id="file-input" accept=".json" onchange="handleFile(event)">
    </div>
    <div id="import-result" class="hidden">
        <h3>Import-Ergebnis</h3>
        <pre id="result-text"></pre>
    </div>
    <div class="import-paste">
        <h3>Oder JSON einfuegen</h3>
        <textarea id="json-paste" rows="10" placeholder='{"nodes": [...], "connections": {...}}'></textarea>
        <button onclick="importFromPaste()" class="btn btn-primary">Importieren</button>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
async function handleDrop(e) {
    e.preventDefault();
    const file = e.dataTransfer.files[0];
    if (file) await uploadFile(file);
}
function handleFile(e) {
    const file = e.target.files[0];
    if (file) uploadFile(file);
}
async function uploadFile(file) {
    const form = new FormData();
    form.append('file', file);
    const resp = await fetch('/api/import', {method: 'POST', body: form});
    const data = await resp.json();
    document.getElementById('import-result').classList.remove('hidden');
    document.getElementById('result-text').textContent = JSON.stringify(data, null, 2);
    if (data.id) setTimeout(() => location.href = '/viewer/' + data.id, 1500);
}
async function importFromPaste() {
    const json = document.getElementById('json-paste').value;
    try { JSON.parse(json); } catch(e) { alert('Ungueltiges JSON'); return; }
    const blob = new Blob([json], {type: 'application/json'});
    const file = new File([blob], 'paste.json', {type: 'application/json'});
    await uploadFile(file);
}
</script>
{% endblock %}
